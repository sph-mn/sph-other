<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1"/>
    <title>jp shop urls</title>

    <style>
      html {
          font-size: 16px;
          font-family: monospace;
      }
      body {
          background-color: black;
          color: #ddd;
      }
      body a {
          color: #ddd;
      }
      a:hover {
          text-decoration: none;
          color: #aaa;
      }
      .hidden {
          display: none;
      }
      .link-button {
          cursor: pointer;
          text-decoration: underline;
      }
      body > * {
    padding: 0.5rem;
}
section > .label ~ * {
    margin-left: 1rem;
    margin-top: 10px;
}
#keyword_selection > .presets > a:not(:first-child) {
    padding-left: 0.5rem;
    margin-bottom: 0.5rem;
    display: inline-block;
}
#keyword_selection .reset {
    margin-left: 0.25rem;
}

    </style>
  </head>
  <body>
    
    <script>
      // https://github.com/KoryNunn/crel 4.2.1
(e => {
  const t = "function",
    n = "isNode",
    o = (e, t) => typeof e === t,
    r = (e, t) => {
      null !== t && (Array.isArray(t) ? t.map(t => r(e, t)) : (i[n](t) || (t = document.createTextNode(t)), e.appendChild(t)))
    };

  function i(e, a) {
    let d, f, l = arguments,
      c = 1;
    if (e = i.isElement(e) ? e : document.createElement(e), o(a, "object") && !i[n](a) && !Array.isArray(a))
      for (d in c++, a) f = a[d], o(d = i.attrMap[d] || d, t) ? d(e, f) : o(f, t) ? e[d] = f : e.setAttribute(d, f);
    for (; c < l.length; c++) r(e, l[c]);
    return e
  }
  i.attrMap = {}, i.isElement = (e => e instanceof Element), i[n] = (e => e instanceof Node), i.proxy = new Proxy(i, {
    get: (e, t) => (!(t in i) && (i[t] = i.bind(null, t)), i[t])
  }), e(i, t)
})((e, t) => {
  "object" == typeof exports ? module.exports = e : typeof define === t && define.amd ? define(() => e) : this.crel = e
});

const config = {
  defaults: {
    brands: [
      "innocent_world",
      "alice_and_the_pirates",
      "metamorphose",
      "angelic_pretty",
      "baby_the_stars_shine_bright"
    ]
  },
  keyword_presets: [
    "お袖とめ",
    "ヘアゴム",
    "グローブ"
  ],
  categories: [
    "accessories",
    "hair_accessories",
    "legwear",
    "one_piece",
    "skirts",
    "small_items",
    "tops"
  ],
  shops: {
    mercari: {
      make_url: function(brand, category, query) {
        category_child = config.shops.mercari.categories[category] || ""
        brand_config = config.shops.mercari.brands[brand]
        brand_name = encodeURIComponent(brand_config.name)
        brand_id = brand_config.id
        keyword = query
        return `https://www.mercari.com/jp/search/?page=1&sort_order=created_desc&keyword=${keyword}&category_root=1&category_child=${category_child}&brand_name=${brand_name}&brand_id=${brand_id}&size_group=&price_min=&price_max=&status_on_sale=1`
      },
      brands: {
        any: {
          name: "",
          id: ""
        },
        alice_and_the_pirates: {
          name: "アリス+アンド+ザ+パイレーツ",
          id: 154
        },
        angelic_pretty: {
          name: "アンジェリック プリティ",
          id: 188
        },
        baby_the_stars_shine_bright: {
          name: "ベイビーザスターズシャインブライト",
          id: 3897
        },
        innocent_world: {
          name: "イノセントワールド",
          id: 4046
        },
        metamorphose: {
          name: "メタモルフォーゼ タンドゥフィーユ",
          id: 1223
        }
      },
      categories: {
        accessories: 21,
        bags: 20,
        hair_accessories: 22,
        legwear: 18,
        one_piece: 15,
        pants: 13,
        shoes: 16,
        skirt: 14,
        small_items: 23,
        tops: 11
      }
    },
    rakuma: {
      make_url: (brand, category, query) => {
        brand_id = config.shops.rakuma.brands[brand]
        category_id = config.shops.rakuma.categories[category] || config.shops.rakuma.root_categories.ladies
        return `https://fril.jp/s?query=${query}&category_id=${category_id}&brand_id=${brand_id}&transaction=selling&sort=created_at&order=desc`
      },
      brands: {
        any: "",
        innocent_world: 384,
        alice_and_the_pirates: 34,
        metamorphose: 533,
        angelic_pretty: 49,
        baby_the_stars_shine_bright: 81
      },
      root_categories: {
        ladies: 10001
      },
      categories: {
        accessories: 8,
        bags: 5,
        hair_accessories: 9,
        legwear: 15,
        one_piece: 2,
        pants: 3,
        shoes: 7,
        skirt: 4,
        small_items: 6,
        tops: 1
      }
    },
    closetchild: {
      make_url: (brand, category, query) => {
        var category_id
        if (category) {
          category_id = config.shops.closetchild.categories[brand][category]
        } else {
          category_id = config.shops.closetchild.brands[brand]
        }
        return `https://www.closetchildonlineshop.com/product-list/${category_id}?available=1&keyword=${query}`
      },
      brands: {
        any: "",
        alice_and_the_pirates: 213,
        angelic_pretty: 190,
        baby_the_stars_shine_bright: 202,
        innocent_world: 235,
        metamorphose: 279
      },
      categories: {
        alice_and_the_pirates: {
          accessories: 8,
          bags: 5,
          hair_accessories: 9,
          legwear: 15,
          one_piece: 2,
          pants: 3,
          shoes: 7,
          skirt: 4,
          small_items: 6,
          tops: 1
        },
        angelic_pretty: {
          accessories: 8,
          bags: 5,
          hair_accessories: 9,
          legwear: 15,
          one_piece: 2,
          pants: 3,
          shoes: 7,
          skirt: 4,
          small_items: 6,
          tops: 1
        },
        baby_the_stars_shine_bright: {
          accessories: 8,
          bags: 5,
          hair_accessories: 9,
          legwear: 15,
          one_piece: 2,
          pants: 3,
          shoes: 7,
          skirt: 4,
          small_items: 6,
          tops: 1
        },
        innocent_world: {
          accessories: 8,
          bags: 5,
          hair_accessories: 9,
          legwear: 15,
          one_piece: 2,
          pants: 3,
          shoes: 7,
          skirt: 4,
          small_items: 6,
          tops: 1
        },
        metamorphose: {
          accessories: 8,
          bags: 5,
          hair_accessories: 9,
          legwear: 15,
          one_piece: 2,
          pants: 3,
          shoes: 7,
          skirt: 4,
          small_items: 6,
          tops: 1
        }
      }
    },
    wunderwelt: {
      make_url: (brand, category, query) => {
        var brand_id = config.shops.wunderwelt.brands[brand]
        var category_id = config.shops.wunderwelt.categories[category] || ""
        return `https://www.wunderwelt.jp/brands/${brand_id}/${category_id}?keywords=${query}`
      },
      brands: {
        any: "lolita-fashion",
        alice_and_the_pirates: "alice-and-the-pirates",
        angelic_pretty: "angelic-pretty",
        baby_the_stars_shine_bright: "baby-the-stars-shine-bright",
        innocent_world: "innocent-world",
        metamorphose: "metamorphose"
      },
      categories: {
        accessories: 8,
        bags: 5,
        hair_accessories: 9,
        legwear: 15,
        one_piece: "one-piece",
        pants: 3,
        shoes: 7,
        skirt: 4,
        small_items: 6,
        tops: 1
      }
    }
  }
}

/*
    baby_the_stars_shine_bright: {},
    angelic_pretty_paris: {},
    angelic_pretty: {},
    innocent_world: {},
    metamorphose: {}
*/

const i18n = {
  language: "jp",
  translate: (key) => {
    return i18n.translations[i18n.language][key] || (key && key.replace(/_/g, " "))
  },
  translations: {
    jp: {
      cuffs: "お袖とめ",
      hair_ties: "ヘアゴム",
      gloves: "グローブ",
      accessories: "アクセサリー",
      hair_accessories: "ヘアアクセサリー",
      legwear: "レッグウェア",
      one_piece: "ワンピース",
      skirts: "スカート",
      small_items: "小物",
      tops: "トップス",
      alice_and_the_pirates: "アリス アンド ザ パイレーツ",
      angelic_pretty: "アンジェリック プリティ",
      baby_the_stars_shine_bright: "ベイビーザスターズシャインブライト",
      innocent_world: "イノセントワールド",
      metamorphose: "メタモルフォーゼ タンドゥフィーユ",
      any: "フリー",
      keywords: "キーワード",
      brands: "ブランド",
      clear: "クリア"
    },
    en: {
      "お袖とめ": "cuffs",
      "ヘアゴム": "hair ties",
      "グローブ": "gloves"
    }
  }
}

const helper = {
  make_section: (id, label) => {
    let div = crel("div", {
      "class": "label"
    }, label)
    return crel("section", {
      id: id
    }, div)
  },
  make_link_button: (label) => {
    return crel("a", {
      "class": "link-button",
      href: "#"
    }, label)
  }
}

class keyword_selection_class {
  dom = {}
  build() {
    let preset_links = config.keyword_presets.map(string => {
      let link = helper.make_link_button(i18n.translate(string))
      link.addEventListener("click", event => {
        this.dom.input.value = string
      })
      return link
    })
    this.dom.presets = crel("div", {
      "class": "presets"
    }, preset_links)
    this.dom.input = crel("input", {
      "class": "input"
    })
    this.dom.input.addEventListener("keyup", event => {
      this.update_links()
    })
    this.dom.reset = crel("button", {
      "class": "reset"
    }, i18n.translate("clear"))
    this.dom.reset.addEventListener("click", event => {
      this.dom.input.value = ""
    })
    let text_input = crel("div", this.dom.input, this.dom.reset)
    let section = helper.make_section("keyword_selection", i18n.translate("keywords"))
    section.appendChild(this.dom.presets)
    section.appendChild(text_input)
    this.dom.container = section
  }
  constructor() {
    this.build()
  }
}

class brand_selection_class {
  dom = {}
  build() {
    let brands = Object.keys(config.shops).map(shop => {
      return Object.keys(config.shops[shop].brands)
    }).flat()
    brands = [...new Set(brands)]
    let checkboxes = brands.map(brand => {
      const input = crel("input", {
        type: "checkbox",
        value: brand
      })
      if (config.defaults.brands.includes(brand)) {
        input.checked = true
      }
      return crel("label", {
        "class": "checkboxes"
      }, input, i18n.translate(brand))
    })
    this.dom.checkboxes = crel("div", {
      "class": "checkboxes"
    }, checkboxes)
    let section = helper.make_section("brand_selection", i18n.translate("brands"))
    section.appendChild(this.dom.checkboxes)
    this.dom.container = section
  }
  get_selections() {
    let checkboxes = this.dom.checkboxes.querySelectorAll("input:checked")
    return Array.from(checkboxes).map(x => x.value)
  }
  constructor() {
    this.build()
  }
}

class category_selection_class {
  dom = {}
  build() {
    let links = config.categories.map(name => {
      let link = helper.make_link_button(i18n.translate(name))
      link.addEventListener("click", event => {
        this.currentCategory = name
      })
      return link
    })
    this.dom.links = crel("div", {
      "class": "links"
    }, links)
    let section = helper.make_section("category_selection", i18n.translate("categories"))
    section.appendChild(this.dom.links)
    this.dom.container = section
  }
  constructor() {
    this.build()
  }
}


class link_list_class {
  dom = {
  }
  make_links(brands, category, keyword) {
    return Object.keys(config.shops).map(shop => {
      let links = brands.map(brand => {
        if (!shop.brands[brand]) return
        const url = config.shops[shop].make_url(brand, category, keyword)
        const label = [shop, brand, category, keyword].filter(a => a).join(" - ")
        return crel("a", {href: url, target: "_blank"}, label)
      })
      return links.filter(a => a)
    }).flat()
  }
  build() {
    this.dom.links = crel("div", {"class": "links"})
    section = helper.make_section("link_list", i18n.translate("links"))
    section.appendChild(this.dom.links)
    this.dom.container = section
  }
  update() {
    let keyword = app.keyword_selection.get_selections()
    let category = app.category_selection.get_selections()
    let brands = app.brand_selection.get_selections()
    const links = this.make_links(brands, category, keyword)
    this.dom.links.innerHTML = ""
    links.forEach(link => {
      this.dom.links.appendChild(link)
    })
  }
  constructor(app) {
    this.app = app
    this.build()
  }
}

class app_class {
  dom = {
    container: document.querySelector("body")
  }
  constructor() {
    this.keyword_selection = new keyword_selection_class(this)
    this.dom.container.appendChild(this.keyword_selection.dom.container)
    this.brand_selection = new brand_selection_class(this)
    this.dom.container.appendChild(this.brand_selection.dom.container)
    this.category_selection = new category_selection_class(this)
    this.dom.container.appendChild(this.category_selection.dom.container)
    this.link_list = new link_list_class(this)
  }
}

new app_class

    </script>
  </body>
</html>
